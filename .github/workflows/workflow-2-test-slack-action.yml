name: Test slack action

on:
  workflow_dispatch:

run-name: Test create item by curl

jobs:
  test_list_creation:
    runs-on: ubuntu-latest
    steps:
      - name: Prepare JSON Payload
        id: prepare_payload
        shell: bash
        run: |
          # 1. DEFINE YOUR IDS
          LIST_ID="F0A9QFB6M0A"
          TITLE_COL_ID="Col0A992EB09M"
          
          TIMESTAMP=$(date "+%Y-%m-%d %H:%M:%S")
          MESSAGE="Proof of Concept via CURL at $TIMESTAMP"

          # 2. CONSTRUCT THE JSON
          PAYLOAD=$(cat <<EOF
          {
            "list_id": "$LIST_ID",
            "fields": {
              "$TITLE_COL_ID": {
                "rich_text": [
                  {
                    "type": "rich_text",
                    "elements": [
                      {
                        "type": "rich_text_section",
                        "elements": [
                          {
                            "type": "text",
                            "text": "$MESSAGE"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            }
          }
          EOF
          )

          # 3. WRITE PAYLOAD TO A FILE (Safer for curl than env vars)
          echo "$PAYLOAD" > payload.json

      - name: Send to Slack via CURL
        run: |
          curl -X POST https://slack.com/api/lists.items.create \
            -H "Authorization: Bearer ${{ secrets.SLACK_BOT_TOKEN }}" \
            -H "Content-Type: application/json; charset=utf-8" \
            --data @payload.json
